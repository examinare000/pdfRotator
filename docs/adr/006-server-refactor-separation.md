# ADR-006: サーバーの責務分離と早期リターン指針

## ステータス
採用済み（2025-12-23）

## 背景
- サーバーコードの可読性とテスタビリティを高める必要がある。
- ルーティング、入力検証、業務ロジック、エラーハンドリングが密結合になりやすい。
- if-else のネストは可読性を下げ、意図把握に時間がかかる。

## 決定
- ルーティングは薄く保ち、処理本体はハンドラ/ユースケースへ分離する。
- 入力検証・変換・共通レスポンスは専用ユーティリティに切り出す。
- if-else の深いネストは避け、ガード節による早期リターンを標準とする。
- 依存は注入可能にし、ユニットテストで外部依存をモックできる構成にする。

## 根拠
- 責務分離により変更の影響範囲が明確になり、読みやすさが向上する。
- 早期リターンは条件分岐の見通しを良くし、バグ混入を減らす。
- 依存注入はテスト容易性と再利用性を高める。

## トレードオフ
- ファイル数が増え、初期の理解コストは増える。
- ルールの順守が必要で、実装の自由度が一部制限される。

## 影響範囲
- バックエンド: ルート/ハンドラ/ユーティリティの構成見直し。
- テスト: ハンドラ単位のユニットテスト追加/更新。
